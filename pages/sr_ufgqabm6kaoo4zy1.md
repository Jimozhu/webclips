---
title: "流媒体技术学习笔记"
date: 2022-10-18T10:00:31+08:00
draft: false
categories: [dev]
tags: [dev]
---
> 原文地址 [www.cnblogs.com](https://www.cnblogs.com/tinywan/p/6236856.html)

### 码流、码率、采样率、比特率、帧速率、分辨率、高清视频的概念

![](https://simpleread.oss-cn-guangzhou.aliyuncs.com/sr_ufgqabm6kaoo4zy1/ab029e75.png)

# 高清视频主要编码

480P 格式：720x480

720P 格式：1280x720【表现体育节目、快速运动的视频时，720P 更明显】

1080P 格式：1920x1080【适合普通电视节目、电影等慢速运动的视频时，1080P 更明显】

## 1、码流（码率）

码流 (Data Rate/Frame Rate/bitsPerSecond) 是指视频文件在单位时间内使用的数据流量，也叫码率或码流率，通俗一点的理解就是取样率, 是视频编码中画面质量控制中最重要的部分，一般我们用的单位是 kb/s 或者 Mb/s。一般来说同样分辨率下，视频文件的码流越大，压缩比就越小，画面质量就越高。码流越大，说明单位时间内取样率越大，数据流，精度就越高，处理出来的文件就越接近原始文件，图像质量越好，画质越清晰，要求播放设备的解码能力也越高。

当然，码流越大，文件体积也越大，其计算公式是文件体积 = 时间 X 码率 / 8。例如，网络上常见的一部 90 分钟 1Mbps 码流的 720P RMVB 文件，其体积就 = 5400 秒 ×1Mb/8=675MB。

通常来说，一个视频文件包括了画面及声音，例如一个 RMVB 的视频文件，里面包含了视频信息和音频信息，音频及视频都有各自不同的采样方式和比特率，也就是说，同一个视频文件音频和视频的比特率并不是一样的。而我们所说的一个视频文件码流率大小，一般是指视频文件中音频及视频信息码流率的总和。

以以国内最流行，大家最熟悉的 RMVB 视频文件为例，RMVB 中的 VB，指的是 VBR，即 Variable Bit Rate 的缩写，中文含义是可变比特率，它表示 RMVB 采用的是动态编码的方式，把较高的采样率用于复杂的动态画面 (歌舞、飞车、战争、动作等)，而把较低的采样率用于静态画面，合理利用资源，达到画质与体积可兼得的效果。

**码率和取样率最根本的差别就是码率是针对源文件来讲的。**

## 2、采样率(Sample Rate)

采样率（也称为采样速度或者采样频率）定义了每秒从连续信号中提取并组成离散信号的采样个数，它用赫兹（Hz）来表示。采样率是指将模拟信号转换成数字信号时的采样频率，也就是单位时间内采样多少点。一个采样点数据有多少个比特。比特率是指每秒传送的比特 (bit) 数。单位为 bps(Bit Per Second)，比特率越高，传送的数据越大，音质越好. 比特率 = 采样率 x 采用位数 x 声道数.

采样率类似于动态影像的帧数，比如电影的采样率是 24 赫兹，PAL 制式的采样率是 25 赫兹，NTSC 制式的采样率是 30 赫兹。当我们把采样到的一个个静止画面再以采样率同样的速度回放时，看到的就是连续的画面。同样的道理，把以 44.1kHZ 采样率记录的 CD 以同样的速率播放时，就能听到连续的声音。显然，这个采样率越高，听到的声音和看到的图像就越连贯。当然，人的听觉和视觉器官能分辨的采样率是有限的，基本上高于 44.1kHZ 采样的声音，绝大部分人已经觉察不到其中的分别了。

而声音的位数就相当于画面的颜色数，表示每个取样的数据量，当然数据量越大，回放的声音越准确，不至于把开水壶的叫声和火车的鸣笛混淆。同样的道理，对于画面来说就是更清晰和准确，不至于把血和西红柿酱混淆。不过受人的器官的机能限制，16 位的声音和 24 位的画面基本已经是普通人类的极限了，更高位数就只能靠仪器才能分辨出来了。比如电话就是 3kHZ 取样的 7 位声音，而 CD 是 44.1kHZ 取样的 16 位声音，所以 CD 就比电话更清楚。

当你理解了以上这两个概念，比特率就很容易理解了。以电话为例，每秒 3000 次取样，每个取样是 7 比特，那么电话的比特率是 21000。 而 CD 是每秒 44100 次取样，两个声道，每个取样是 13 位 PCM 编码，所以 CD 的比特率是 44100\*2\*13=1146600，也就是说 CD 每秒的数据量大约是 144KB，而一张 CD 的容量是 74 分等于 4440 秒，就是 639360KB ＝ 640MB。

**码率和取样率最根本的差别就是码率是针对源文件来讲的。**

## 3、比特率(BPS)

**比特率是指每秒传送的比特 (bit) 数。单位为 bps(Bit Per Second)，比特率越高，传送的数据越大。在视频领域, 比特率常翻译为码率 !!!**

比特率表示经过编码（压缩）后的音、视频数据每秒钟需要用多少个比特来表示，而比特就是二进制里面最小的单位，要么是 0，要么是 1。比特率与音、视频压缩的关系，简单的说就是比特率越高，音、视频的质量就越好，但编码后的文件就越大；如果比特率越少则情况刚好相反。

**比特率是指将数字声音、视频由模拟格式转化成数字格式的采样率，采样率越高，还原后的音质、画质就越好。**

# 4、常见编码模式：

VBR（Variable Bitrate）动态比特率 也就是没有固定的比特率，压缩软件在压缩时根据音频数据即时确定使用什么比特率，这是以质量为前提兼顾文件大小的方式，推荐编码模式；

ABR（Average Bitrate）平均比特率 是 VBR 的一种插值参数。LAME 针对 CBR 不佳的文件体积比和 VBR 生成文件大小不定的特点独创了这种编码模式。ABR 在指定的文件大小内，以每 50 帧（30 帧约 1 秒）为一段，低频和不敏感频率使用相对低的流量，高频和大动态表现时使用高流量，可以做为 VBR 和 CBR 的一种折衷选择。

CBR（Constant Bitrate），常数比特率 指文件从头到尾都是一种位速率。相对于 VBR 和 ABR 来讲，它压缩出来的文件体积很大，而且音质相对于 VBR 和 ABR 不会有明显的提高。

## 5、帧速率(FPS)

## 帧速率也称为 FPS(Frames PerSecond) 的缩写——帧 / 秒。

## 是指每秒钟刷新的图片的帧数，也可以理解为图形处理器每秒钟能够刷新几次。越高的帧速率可以得到更流畅、更逼真的动画。每秒钟帧数 (FPS) 越多，所显示的动作就会越流畅。

影响 FPS 值的主要因素就是显卡，一款好的独立显卡会对 FPS 的提升有着很大的作用。如果 FPS 值过低可以尝试通过调节一些游戏或者电脑参数来缓解如：降低游戏分辨率、开启垂直同步等等

# 6、分辨率(Resolution)

就是帧大小每一帧就是一副图像。

640x480 分辨率的视频，建议视频的码速率设置在 700 以上，音频采样率 44100 就行了

一个音频编码率为 128Kbps，视频编码率为 800Kbps 的文件，其总编码率为 928Kbps，意思是经过编码后的数据每秒钟需要用 928K 比特来表示。

计算输出文件大小公式：（音频编码率（KBit 为单位）/8 + 视频编码率（KBit 为单位）/8）× 影片总长度（秒为单位）= 文件大小（MB 为单位）

常见分辨率有：

QVGA:320x240
CIF:352×288
VGA:640x480
HD:1360x768
FHD:1920x1080
WQHD:2560x1440
4K UHD:3840x2160

![常见分辨率](https://simpleread.oss-cn-guangzhou.aliyuncs.com/sr_ufgqabm6kaoo4zy1/287c1874.png)

# 7、高清视频

目前的 720P 以及 1080P 采用了很多种编码，例如主流的 MPEG2，VC-1 以及 H.264，还有 Divx 以及 Xvid，至于封装格式更多到令人发指，ts、mkv、wmv 以及蓝光专用等等。

720 和 1080 代表视频流的分辨率，前者 1280*720，后者 1920*1080，不同的编码需要不同的系统资源，大概可以认为是 H.264>VC-1>MPEG2。

VC-1 是最后被认可的高清编码格式，不过因为有微软的后台，所以这种编码格式不能小窥。相对于 MPEG2，VC-1 的压缩比更高，但相对于 H.264 而言，编码解码的计算则要稍小一些，目前来看，VC-1 可能是一个比较好的平衡，辅以微软的支持，应该是一只不可忽视的力量。一般来说，VC-1 多为 “.wmv” 后缀，但这都不是绝对的，具体的编码格式还是要通过软件来查询。

总的来说，从压缩比上来看，H.264 的压缩比率更高一些，也就是同样的视频，通过 H.264 编码算法压出来的视频容量要比 VC-1 的更小，但是 VC-1 格式的视频在解码计算方面则更小一些，一般通过高性能的 CPU 就可以很流畅的观看高清视频。相信这也是目前 NVIDIA Geforce 8 系列显卡不能完全解码 VC-1 视频的主要原因。

PS&TS 是两种视频或影片封装格式，常用于高清片。扩展名分别为 VOB/EVO 和 TS 等；其文件编码一般用 MPEG2/VC-1/H.264

高清，英文为 “High Definition”，即指 “高分辨率”。 高清电视 (HDTV)，是由美国电影电视工程师协会确定的高清晰度电视标准格式。现在的大屏幕液晶电视机，一般都支持 1080i 和 720P，而一些俗称的 “全高清”(Full HD)，则是指支持 1080P 输出的电视机。

目前的高清视频编码格式主要有 H.264、VC-1、MPEG-2、MPEG-4、DivX、XviD、WMA-HD 以及 X264。事实上，现在网络上流传的高清视频主要以两类文件的方式存在：一类是经过 MPEG-2 标准压缩，以 tp 和 ts 为后缀的视频流文件; 一类是经过 WMV-HD(Windows Media Video HighDefinition) 标准压缩过的 wmv 文件，还有少数文件后缀为 avi 或 mpg，其性质与 wmv 是一样的。真正效果好的高清视频更多地以 H.264 与 VC-1 这两种主流的编码格式流传。

**一般来说，H.264 格式以 “.avi”、“.mkv” 以及 “.ts” 封装比较常见。**

# 8、声道、声道数(Sound Channel)

声道（Sound Channel）是指声音在录制（或播放）时，在不同空间位置采集（或播放）的相互独立的音频信号。所谓声道数，也就是声音录制时的音源数量或播放时的扬声器数量。

# 9、ffmpeg

## ffmpeg 命令参数类型

在继续讲其他的 ffmpeg 命令行用法之前，需要先讲 一下 ffmpeg 处理命令行参数的一些逻辑。ffmpeg 命令行 其实分为 6 个部分。如下图：

![](https://simpleread.oss-cn-guangzhou.aliyuncs.com/sr_ufgqabm6kaoo4zy1/ee202c13.jpe)

1，可执行文件 ，就是 ffmpeg 那个软件。

2，输入文件参数，在 -i 前面那些参数，全部都作用于 当前 的输入文件。

3，输入文件， -i 指定输入文件。

4，输出文件参数，前面什么都没有，只有一个输出文件名，输出文件名 前面的那些参数 就是输出文件参数，全部都作用于 当前的输出文件。

5，输出文件，juren.ts 就是输出文件。

6，全局参数， `-y` 跟 `-benchmark` 这些跟输入输出文件无关的参数就是全局参数。

上面我为什么强调 当前 ，是因为 ffmpeg 是支持多个输入文件跟多个输出文件的，多个文件可以有各自的独立参数。多输入文件在复杂滤镜的场景经常使用。

虽然 ffmpeg 有很多很多的命令参数，但是只要你记住 ffmpeg 的参数类型，就会很容易学会 其他 参数的使用。

ffmpeg 处理命令行参数的代码 实际上是一个有限状态机。很多时候是没有先后顺序的，我上图是比较正确的写法，先是 输入，再是输出，再是 全局参数。

但是实际上，你可以把 输出 的命令参数放在前面。如下：

```bash
ffmpeg -c copy -t 10 -f mpegts juren.ts -ss 00:01:32 -f flv -i juren.flv -y -benchmark
```

你甚至 可以把 全局参数 插在 -i 前面，他依然是全局参数，不会被当成是输入文件参数，如下：

```bash
ffmpeg -c copy -t 10 -f mpegts juren.ts -ss 00:01:32 -f flv -y -benchmark -i juren.flv
```
